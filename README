# GeoNames åœ°ç†æ•°æ®å¯¼å…¥å·¥å…·

è¿™æ˜¯ä¸€ä¸ªç”¨Goè¯­è¨€ç¼–å†™çš„åœ°ç†æ•°æ®å¯¼å…¥å·¥å…·ï¼Œç”¨äºå°†MaxMind GeoLite2åŸå¸‚ä½ç½®æ•°æ®ä»CSVæ ¼å¼å¯¼å…¥åˆ°SQLiteæ•°æ®åº“ä¸­ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“Š å°†GeoLite2-City-Locations-en.csvæ–‡ä»¶å¯¼å…¥åˆ°SQLiteæ•°æ®åº“
- ğŸ—ƒï¸ è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„
- âš¡ æ‰¹é‡å¯¼å…¥ä¼˜åŒ–ï¼Œæé«˜æ•°æ®æ’å…¥æ•ˆç‡
- ğŸ” æ”¯æŒå®Œæ•´çš„åœ°ç†ä¿¡æ¯æŸ¥è¯¢ï¼ŒåŒ…æ‹¬ï¼š
  - åŸå¸‚åç§°
  - å›½å®¶ä¿¡æ¯
  - å¤§æ´²ä¿¡æ¯
  - è¡Œæ”¿åŒºåˆ’ä¿¡æ¯
  - æ—¶åŒºä¿¡æ¯
  - æ¬§ç›Ÿæˆå‘˜å›½æ ‡è¯†

## é¡¹ç›®ç»“æ„

```
geonames/
â”œâ”€â”€ main.go                           # ä¸»ç¨‹åºæ–‡ä»¶
â”œâ”€â”€ go.mod                           # Goæ¨¡å—ä¾èµ–
â”œâ”€â”€ go.sum                           # ä¾èµ–æ ¡éªŒæ–‡ä»¶
â”œâ”€â”€ Makefile                         # æ„å»ºè„šæœ¬
â”œâ”€â”€ README                           # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ geonames.db                      # ç”Ÿæˆçš„SQLiteæ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ geonames                         # ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ GeoLite2-City-Locations-en.csv   # è¾“å…¥çš„åœ°ç†æ•°æ®æ–‡ä»¶
â””â”€â”€ .gitignore                       # Gitå¿½ç•¥æ–‡ä»¶
```

## æ•°æ®æ¨¡å‹

å·¥å…·ä½¿ç”¨`GeoNames`ç»“æ„ä½“æ¥è¡¨ç¤ºåœ°ç†æ•°æ®ï¼š

```go
type GeoNames struct {
    GeoNameID           int    // åœ°ç†åç§°ID
    LocaleCode          string // è¯­è¨€ä»£ç 
    ContinentCode       string // å¤§æ´²ä»£ç 
    ContinentName       string // å¤§æ´²åç§°
    CountryIsoCode      string // å›½å®¶ISOä»£ç 
    CountryName         string // å›½å®¶åç§°
    Subdivision1IsoCode string // ä¸€çº§è¡Œæ”¿åŒºISOä»£ç 
    Subdivision1Name    string // ä¸€çº§è¡Œæ”¿åŒºåç§°
    Subdivision2IsoCode string // äºŒçº§è¡Œæ”¿åŒºISOä»£ç 
    Subdivision2Name    string // äºŒçº§è¡Œæ”¿åŒºåç§°
    CityName            string // åŸå¸‚åç§°
    MetroCode           string // éƒ½ä¼šåŒºä»£ç 
    TimeZone            string // æ—¶åŒº
    IsInEuropeanUnion   string // æ˜¯å¦åœ¨æ¬§ç›Ÿå†…
}
```

## ä¾èµ–é¡¹

- **Go 1.22.6+** - ç¼–ç¨‹è¯­è¨€ç¯å¢ƒ
- **GORM v1.30.0** - ORMæ¡†æ¶
- **SQLiteé©±åŠ¨ v1.6.0** - æ•°æ®åº“é©±åŠ¨

## å®‰è£…å’Œè¿è¡Œ

### å‰ç½®è¦æ±‚

1. ç¡®ä¿å·²å®‰è£…Go 1.22.6æˆ–æ›´é«˜ç‰ˆæœ¬
2. ç¡®ä¿æœ‰GeoLite2-City-Locations-en.csvæ•°æ®æ–‡ä»¶

### æ„å»ºå’Œè¿è¡Œ

ä½¿ç”¨Makefileè¿›è¡Œæ„å»ºå’Œè¿è¡Œï¼š

```bash
# æ¸…ç†å¹¶æ„å»ºé¡¹ç›®
make build

# è¿è¡Œç¨‹åº
make run

# æˆ–è€…ä¸€æ­¥å®Œæˆæ„å»ºå’Œè¿è¡Œ
make all
```

### æ‰‹åŠ¨æ„å»º

```bash
# æ•´ç†ä¾èµ–
go mod tidy

# æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶
go build -o geonames main.go

# è¿è¡Œç¨‹åº
./geonames
```

## ä½¿ç”¨è¯´æ˜

1. **å‡†å¤‡æ•°æ®æ–‡ä»¶**ï¼šç¡®ä¿`GeoLite2-City-Locations-en.csv`æ–‡ä»¶å­˜åœ¨äºé¡¹ç›®æ ¹ç›®å½•
2. **è¿è¡Œç¨‹åº**ï¼šæ‰§è¡Œ`make run`æˆ–ç›´æ¥è¿è¡Œ`./geonames`
3. **æŸ¥çœ‹ç»“æœ**ï¼šç¨‹åºä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆ`geonames.db`SQLiteæ•°æ®åº“æ–‡ä»¶

## CSVæ–‡ä»¶æ ¼å¼

è¾“å…¥æ–‡ä»¶åº”åŒ…å«ä»¥ä¸‹åˆ—ï¼ˆæŒ‰é¡ºåºï¼‰ï¼š
1. geoname_id - åœ°ç†åç§°ID
2. locale_code - è¯­è¨€ä»£ç 
3. continent_code - å¤§æ´²ä»£ç 
4. continent_name - å¤§æ´²åç§°
5. country_iso_code - å›½å®¶ISOä»£ç 
6. country_name - å›½å®¶åç§°
7. subdivision_1_iso_code - ä¸€çº§è¡Œæ”¿åŒºISOä»£ç 
8. subdivision_1_name - ä¸€çº§è¡Œæ”¿åŒºåç§°
9. subdivision_2_iso_code - äºŒçº§è¡Œæ”¿åŒºISOä»£ç 
10. subdivision_2_name - äºŒçº§è¡Œæ”¿åŒºåç§°
11. city_name - åŸå¸‚åç§°
12. metro_code - éƒ½ä¼šåŒºä»£ç 
13. time_zone - æ—¶åŒº
14. is_in_european_union - æ˜¯å¦åœ¨æ¬§ç›Ÿå†…

## æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹

å¯¼å…¥å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨SQLiteå®¢æˆ·ç«¯æŸ¥è¯¢æ•°æ®ï¼š

```sql
-- æŸ¥è¯¢æ‰€æœ‰åŸå¸‚
SELECT city_name, country_name FROM geonames WHERE city_name IS NOT NULL;

-- æŸ¥è¯¢ç‰¹å®šå›½å®¶çš„åŸå¸‚
SELECT city_name FROM geonames WHERE country_iso_code = 'CN';

-- æŸ¥è¯¢æ¬§ç›Ÿå›½å®¶çš„åŸå¸‚
SELECT city_name, country_name FROM geonames WHERE is_in_european_union = '1';

-- æŸ¥è¯¢ç‰¹å®šæ—¶åŒºçš„åŸå¸‚
SELECT city_name, country_name FROM geonames WHERE time_zone = 'Asia/Shanghai';
```

## æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨GORMçš„æ‰¹é‡æ’å…¥åŠŸèƒ½ï¼ˆCreateBatchSize: 1000ï¼‰
- é™é»˜æ—¥å¿—æ¨¡å¼å‡å°‘I/Oå¼€é”€
- è‡ªåŠ¨æ•°æ®åº“è¿ç§»ç¡®ä¿è¡¨ç»“æ„æ­£ç¡®

## è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨MITè®¸å¯è¯ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªå·¥å…·ã€‚

## ç›¸å…³é“¾æ¥

- [MaxMind GeoLite2](https://dev.maxmind.com/geoip/geoip2/geolite2/) - å…è´¹çš„åœ°ç†ä½ç½®æ•°æ®
- [GORM](https://gorm.io/) - Goè¯­è¨€çš„ORMæ¡†æ¶
- [SQLite](https://www.sqlite.org/) - è½»é‡çº§æ•°æ®åº“
